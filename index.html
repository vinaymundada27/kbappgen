<!DOCTYPE html>
<html>
<head>
    <link href="css/metro.css" rel="stylesheet">
    <link href="css/metro-icons.css" rel="stylesheet">
    <link href="css/metro-responsive.css" rel="stylesheet">
    <link href="css/metro-rtl.css" rel="stylesheet">
    <link href="css/metro-schemes.css" rel="stylesheet">
    <link href="css/custom.css" rel="stylesheet">
    <!-- <script src="jquery.js"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="js/metro.js"></script>
    <script src="js/jquery-ui/jquery-ui.min.js"></script>
</head>
<body>
  <div class="grid">
    <div class="row cells4">
        <div class="cell" id="input-cell">
        	<h2>Input elements:</h2>
        	<div id="textInputDiv" class="textInput draggable">
        	  <label>Text input:</label>
        	  <div class="input-control text">
                 <input type="text" placeholder="Input your text here...">
              </div>
            </div>
            <div id="checkboxes" class="checkboxes draggable">
                <label>Checkboxes: </label>
            	<label class="input-control checkbox small-check">
				  <input type="checkbox" checked>
				  <span class="check"></span>
				  <span class="caption">Checkbox</span>
				</label>
				<label class="input-control checkbox small-check">
				  <input type="checkbox" checked>
				  <span class="check"></span>
				  <span class="caption">Checkbox</span>
				</label>
            </div>
            <div id="radioButtonsDiv" class="radioButtons draggable">
              <label>Radio buttons: </label>
              <label class="input-control radio small-check">
			    <input type="radio">
			    <span class="check"></span>
			    <span class="caption">Small radio</span>
			  </label>
			  <label class="input-control radio small-check">
			    <input type="radio">
			    <span class="check"></span>
			    <span class="caption">Small radio</span>
			  </label>
            </div>
            <div id="switchersDiv" class="switchers draggable">
              <label>Switcher: </label>
              <label class="switch-original">
			    <input type="checkbox">
			    <span class="check"></span>
			  </label>
            </div>
            <div id="textBoxDiv" class="textBox draggable">
              <label>Textbox: </label>
              <div class="input-control textarea">
			    <textarea></textarea>
			  </div>
            </div>
            <div id="multiSelectDiv" class="multiSelect draggable">
              <label>Selection: </label>
              <div class="input-control select">
				<select>
				  <option>1</option>
				  <option>2</option>
				  <option>3</option>
				</select>
			  </div>
            </div>
            <div id="fileUploadDiv" class="fileUpload draggable">
              <div class="input-control file" data-role="input">
                <label>File Upload: </label>
			    <input type="file">
			    <button class="button"><span class="mif-folder"></span></button>
			  </div>
            </div>
            <div id="buttonsDiv" class="buttons draggable">
              <label>Button: </label>
              <input type="button" value="Button">
            </div>
            <div id="slidersDiv" class="sliders draggable">
               <label>Sliders: </label>
               <div class="slider" data-role="slider"></div>
            </div>
        </div>
        <div class="cell droppable" style="height: 600px;" id="drawspace1">
        	<h2>Input</h2>
        </div>
        <div class="cell droppable" style="height: 600px;" id="drawspace2">
        	<h2>Screen</h2>
        </div>
        <div class="cell">
            <h2>Status</h2>
            <h4>Current screen: <span id="screen_status">INPUT</span></h4>
            <input type="button" value="Save To Disk">
            <div></div>
            <input type="button" value="Next Screen" onclick="get_screen_of('next')">
            <input type="button" value="Prev Screen" onclick="get_screen_of('prev')">
        </div>
    </div>
  </div>
</body>
<script>
        GLOBAL_COUNTER = 0;
        NUM_COLUMNS = 2;
        created_ids = [];
        
        screens = {
            "input" : {
            	"value" : ["<h2>Input</h2>",
            	           "<h2>Screen</h2>"],
            	"next" : "review",
            	"prev" : "final"
            },
            "review" : {
            	"value" : ["<h2>Review</h2>",
            	           "<h2>Screen</h2>"],
            	"next" : "kbe",
            	"prev" : "input"
            },
            "kbe" : {
            	"value" : ["<h2>KBE</h2>",
            	           "<h2>Screen</h2>"],
            	"next" : "final",
            	"prev" : "review"
            },
            "final" : {
            	"value" : ["<h2>Final</h2>",
            	           "<h2>Screen</h2>"],
            	"next" : "input",
            	"prev" : "kbe"
            }
        }
        function flush_screen() {
        	for (i = 1; i <= NUM_COLUMNS; i++) {
        	   $("#drawspace" + i).children().remove();
            }
        }
        function get_screen_of(opt) {
            curr_screen = $("#screen_status").text().toLowerCase();
            screens[curr_screen].value = screens[curr_screen].value.map(function (column, num) {
            	return $("#drawspace" + (num+1)).html();
            });
            flush_screen();
            opt_screen = screens[curr_screen][opt];
            screens[opt_screen].value.map(function (column, num) {
            	$("#drawspace" + (num+1)).append(column);
            });
            $("#screen_status").text(opt_screen.toUpperCase());
            refresh_events();
        }
        properties = {
        	"textInput": ["title", "placeholder"],
        	"checkboxes": ["title", "names"],
        	"radioButtons": ["title", "names"],
        	"switchers": ["title"],
        	"textBox": ["title"],
        	"multiSelect": ["title", "names"],
        	"fileUpload": ["title"],
        	"buttons": ["title", "apiEndPoint", "allIDs"],
        	"sliders": ["title"]
        }
        function update_element(element_id) {
            text_id = (element_id.split('-')[1]);      
            title_val = $(element_id).children(".input-control").children(".title-input").val();           
            place_val = $(element_id).children(".input-control").children(".placeholder-input").val();
            multi_val = $(element_id).children(".input-control").children(".multi-input").val();

            class_type = $("#" + text_id).prop('class').split(" ")[0];

            $("#" + text_id + " > " + "label:first-child").text(title_val);

            if (class_type == "textInput") {     
              $("#" + text_id).children(".input-control").children("input").prop("placeholder", place_val);

            }
            else if (class_type == "checkboxes") {
              $("#" + text_id).children(".input-control").remove();
              check_labels = multi_val.split(",").map(function(label) {
              	return '<label class="input-control checkbox small-check">' +
              	       '<input type="checkbox" checked>' +
              	       '<span class="check"></span>' +
              	       '<span class="caption">' + label + '</span>' +
              	       '</label>'
              }).join("");
              $("#" + text_id).append(check_labels);
            }
            else if (class_type == "radioButtons") {
            	$("#" + text_id).children(".input-control").remove();
            	radio_labels = multi_val.split(",").map(function(label) {
            		return '<label class="input-control radio small-check">' +
			               '<input type="radio">' +
			               '<span class="check"></span>' +
			               '<span class="caption">' + label + '</span>' +
			               '</label>';
            	}).join("");
            	$("#" + text_id).append(radio_labels);
            }
            else if (class_type == "multiSelect") {
            	$("#" + text_id + " select").children().remove();
            	select_labels = multi_val.split(",").map(function(label) {
                    return '<option>' + label + '</option>';
            	}).join("");
            	$("#" + text_id + " select").append(select_labels);
            }
            else if (class_type == "buttons") {
            	$("#" + text_id + " input").prop("value", title_val);
            	$("#" + text_id + " > label").remove();
            }
        }
        function delete_element(id) {
        	$("#" + id).remove();
        	$("#dialog-" + id).remove();
        	var i = created_ids.indexOf(id);
            if (i != -1) {
            	created_ids.splice(i, 1);
            }
        }
        function gen_input_element(label, class_name) {
        	return '<label>' + label + '</label>' +
        	       '<div class="input-control text"><input type="text" class="' + class_name + 
        	       '"></div><div></div>'

        }
        function generate_html(type, option) {
        	if (option == "title") {
        	  return gen_input_element("Enter title: ", "title-input");
        	}
        	else if (option == "placeholder") {
        	  return gen_input_element("Enter placeholder: ", "placeholder-input");
        	}
        	else if (option == "names") {
        	  return gen_input_element("Enter various values (seperated by commas): ", "multi-input");
        	}
        	else if (option == "apiEndPoint") {
        	  return gen_input_element("Enter API end point for this button click: ", "api-input");
        	}
        	else if (option == "allIDs") {
        	  return gen_input_element("Enter all IDs of elements' data you want on this button click: ", "all-ids-input");
        	}
        }
        function generate_dialog(type, id) {
        	header_str = '<div data-role="dialog" id="' + id +'" class="padding20" data-close-button="true">';
        	body_str = properties[type].map(function (opt) {
        		return generate_html(type, opt);
        	}).join("");
        	footer_str = '<button class="button" id="button-' + ((id.split('-')[1]) + '') + '">Save</button>'
        	           + '<button class="button" id="delete-' + ((id.split('-')[1]) + '') + '">Delete</button>'
        	           + '</div>';
        	return header_str + body_str + footer_str;
        }
        function showDialog(id){
          var dialog = $(id).data('dialog');
          dialog.open();
        }
		$(function() {
		  $( ".draggable" ).draggable({
		      appendTo: "body",
		      helper: "clone"
		   });
		  $( ".droppable" ).droppable({
		  	drop: function(event, ui) {
		  		var copy_el = ui.draggable.clone();
		  		new_id = GLOBAL_COUNTER++;
		  		copy_el.prop('id', (new_id + ''));
		  		copy_el.appendTo( this );
		  		class_type = copy_el.prop('class').split(" ")[0];
		  		copy_el.append(generate_dialog(class_type, "dialog" + "-" + new_id));
		  		created_ids.push(new_id);
		  		refresh_events();
		  	}
		  });
		});
		function refresh_events() {
			created_ids.map(function(id) {
			  $("#" + id).dblclick(function() {
				showDialog("#dialog" + "-" + id);
			  });
			  $("#button-"+ id).click(function() {
				update_element("#dialog" + "-" + id);
			  });
			  $("#delete-" + id).click(function() {
			  	delete_element(id);
			  });
		    });
		}
	</script>
</html>
